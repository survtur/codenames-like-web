<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<h1>WebSocket Chat</h1>
<input type="text" id="messageText" autocomplete="off"/>
<button type="button" onclick="sendMessage()">Send</button>
<button type="button" onclick="initGame()">Init</button>
<button type="button" onclick="getState()">State</button>
<button type="button" onclick="getReState()">ReState</button>
<button type="button" onclick="openCard()">Open</button>
<ul id='messages'>
</ul>
<script>
    let game = "";
    let ws = new WebSocket("ws://localhost:8000/ws");
    ws.onmessage = (event) => {
        const messages = document.getElementById('messages')
        const message = document.createElement('li')
        const content = document.createTextNode(event.data)
        message.appendChild(content)
        messages.appendChild(message)
        let parsed = JSON.parse(event.data)
        console.log(parsed)

        if (parsed.action === "init") {
            game = parsed.state.name
        }
    };

    function sendMessage(event) {
        let input = document.getElementById("messageText")
        ws.send(JSON.stringify(input.value))
        input.value = ''
        event.preventDefault()
    }

    function initGame(event) {
        const rules = {cards_count: 25, team_cards_count: [2, 1], cards_set: 0, cards_for_first_team: 3};
        ws.send(JSON.stringify({action: 'init', rules: rules}))
    }

    function getState(event) {
        ws.send(JSON.stringify({action: 'full_state', 'game': game}))
    }

    function getReState(event) {
        ws.send(JSON.stringify({action: 'state', 'game': game}))
    }

    function openCard(event) {
        ws.send(JSON.stringify({action: 'open', 'card': 1, 'game': game}))
    }
</script>

</body>
</html>